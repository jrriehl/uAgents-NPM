"use strict";var ke=Object.create;var V=Object.defineProperty,Be=Object.defineProperties,$e=Object.getOwnPropertyDescriptor,Fe=Object.getOwnPropertyDescriptors,Ue=Object.getOwnPropertyNames,de=Object.getOwnPropertySymbols,qe=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var me=Math.pow,ue=(r,t,e)=>t in r?V(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,C=(r,t)=>{for(var e in t||(t={}))pe.call(t,e)&&ue(r,e,t[e]);if(de)for(var e of de(t))Ve.call(t,e)&&ue(r,e,t[e]);return r},$=(r,t)=>Be(r,Fe(t));var He=(r,t)=>{for(var e in t)V(r,e,{get:t[e],enumerable:!0})},ot=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ue(t))!pe.call(r,n)&&n!==e&&V(r,n,{get:()=>t[n],enumerable:!(s=$e(t,n))||s.enumerable});return r},f=(r,t,e)=>(ot(r,t,"default"),e&&ot(e,t,"default")),H=(r,t,e)=>(e=r!=null?ke(qe(r)):{},ot(t||!r||!r.__esModule?V(e,"default",{value:r,enumerable:!0}):e,r)),We=r=>ot(V({},"__esModule",{value:!0}),r);var g=(r,t,e)=>new Promise((s,n)=>{var i=c=>{try{a(e.next(c))}catch(d){n(d)}},o=c=>{try{a(e.throw(c))}catch(d){n(d)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(i,o);a((e=e.apply(r,t)).next())});var h={};He(h,{AGENTVERSE_URL:()=>Ut,AGENT_ADDRESS_LENGTH:()=>kt,AGENT_PREFIX:()=>Lt,ALMANAC_API_MAX_RETRIES:()=>G,ALMANAC_API_TIMEOUT_SECONDS:()=>ze,ALMANAC_API_URL:()=>I,ALMANAC_CONTRACT_VERSION:()=>ut,ALMANAC_REGISTRATION_WAIT:()=>J,ASGI:()=>Ge,AVERAGE_BLOCK_INTERVAL:()=>dt,Agent:()=>je,AlmanacApiRegistrationPolicy:()=>Ct,AlmanacApiResolver:()=>st,AlmanacContractResolver:()=>bt,BatchAlmanacApiRegistrationPolicy:()=>It,BatchLedgerRegistrationPolicy:()=>Nt,Context:()=>Rt,DEFAULT_ENVELOPE_TIMEOUT_SECONDS:()=>x,DEFAULT_MAX_ENDPOINTS:()=>O,DEFAULT_SEARCH_LIMIT:()=>pt,DefaultBatchRegistrationPolicy:()=>ge,DefaultRegistrationPolicy:()=>ce,Envelope:()=>R,EnvelopeHistory:()=>Wt,EnvelopeHistoryEntry:()=>Ht,ErrorMessage:()=>Pe,ExternalContext:()=>ne,GlobalResolver:()=>rt,Identity:()=>v,InternalContext:()=>Mt,KeyValueStore:()=>le,LEDGER_PREFIX:()=>Je,LedgerBasedRegistrationPolicy:()=>Tt,MAILBOX_POLL_INTERVAL_SECONDS:()=>Xe,MAINNET_CONTRACT_ALMANAC:()=>Bt,MAINNET_CONTRACT_NAME_SERVICE:()=>ct,MAINNET_PREFIX:()=>j,MAINNET_RPC:()=>z,Model:()=>_,NameServiceResolver:()=>St,Protocol:()=>ie,REGISTRATION_DENOM:()=>lt,REGISTRATION_FEE:()=>L,REGISTRATION_RETRY_INTERVAL_SECONDS:()=>Ke,REGISTRATION_UPDATE_INTERVAL_SECONDS:()=>Ft,RESPONSE_TIME_HINT_SECONDS:()=>Qe,Resolver:()=>D,RulesBasedResolver:()=>se,TESTNET_CONTRACT_ALMANAC:()=>$t,TESTNET_CONTRACT_NAME_SERVICE:()=>gt,TESTNET_FAUCET:()=>qt,TESTNET_PREFIX:()=>Ot,TESTNET_RPC:()=>K,USER_PREFIX:()=>W,WALLET_MESSAGING_POLL_INTERVAL_SECONDS:()=>Ze,Wallet:()=>Ms,deriveKeyFromSeed:()=>ve,dispatcher:()=>k,encloseResponse:()=>_s,encloseResponseRaw:()=>Re,encodeLengthPrefixed:()=>Z,generateUserAddress:()=>ss,isUserAddress:()=>F,mailbox:()=>ws,parseAgentverseConfig:()=>ts,parseEndpointConfig:()=>Ye,parseIdentifier:()=>B,query:()=>Ss,sendMessage:()=>xe,sendSyncMessage:()=>ys});module.exports=We(h);f(h,require("util"),module.exports);var je="tmp";var Ge="tmp";var Se=require("uuid");var Lt="agent",Je="fetch",W="user",Ot="test-agent",j="agent",kt=65,Bt="fetch1mezzhfj7qgveewzwzdk6lz5sae4dunpmmsjr9u7z0tpmdsae8zmquq3y0y",$t="fetch1tjagw8g8nn4cwuw00cf0m5tl4l6wfw9c0ue507fhx9e3yrsck8zs0l3q4w",ct="fetch1479lwv5vy8skute5cycuz727e55spkhxut0valrcm38x9caa2x8q99ef0q",gt="fetch1mxz8kn3l5ksaftx8a9pj9a6prpzk2uhxnqdkwuqvuh37tw80xu6qges77l",L="500000000000000000",lt="atestfet",Ft=3600,Ke=60,dt=6,ut="2.3.0",Ut="https://agentverse.ai",I=`${Ut}/v1/almanac`,ze=1,G=10,J=100,Xe=1,Ze=2,Qe=5,x=30,O=10,pt=100,K="https://rpc-dorado.fetch.ai",z="https://rpc-fetchhub.fetch.ai",qt="https://faucet-dorado.fetch.ai";function Ye(r){let t=[];return typeof r=="object"&&!Array.isArray(r)&&r!==null?t=Object.entries(r).map(([e,s])=>({url:e,weight:(s==null?void 0:s.weight)||1})):Array.isArray(r)?t=r.map(e=>({url:e,weight:1})):typeof r=="string"&&(t=[{url:r,weight:1}]),t}function ts(r=null){let t=null,e=Ut,s=null,n=null;return typeof r=="string"?r.includes("@")?[t,e]=r.split("@"):r.includes("://")?e=r:t=r:typeof r=="object"&&r!==null&&(t=r.agent_mailbox_key||null,e=r.base_url||e,n=r.protocol||null),[s,e]=e.includes("://")?e.split("://"):[null,e],s=n||s||"https",{agentMailboxKey:t,baseUrl:e,protocol:s,httpPrefix:s==="wss"||s==="https"?"https":"http",useMailbox:t!==null}}var fe=require("crypto"),ye=require("elliptic"),Q=require("bech32"),Y=require("js-sha256");var _e=2e3,es=256,X=new ye.ec("secp256k1");function he(r){let t=Q.bech32.decode(r,_e),e=Buffer.from(Q.bech32.fromWords(t.words));return[t.prefix,e]}function mt(r,t){let e=Q.bech32.toWords(t);return Q.bech32.encode(r,e,_e)}function ss(){return mt(W,(0,fe.randomBytes)(32))}function F(r){return r.substring(0,W.length)===W}function rs(r,t){let e=Y.sha256.create();if(e.update(r),!(0<=t&&t<es))throw new Error("Index out of bounds");return e.update(Buffer.from([t])),Buffer.from(e.digest())}function ns(r){let t=Y.sha256.create();return t.update(r),Buffer.from(t.digest())}function ve(r,t,e){let s=Y.sha256.create();return s.update(rs(t,e)),s.update(ns(r)),Buffer.from(s.digest())}function Z(r){let t;if(typeof r=="string")t=Buffer.from(r);else if(typeof r=="number")t=Buffer.alloc(8),t.writeBigUInt64BE(BigInt(r));else if(Buffer.isBuffer(r))t=r;else throw new Error("Invalid type for encoding");let e=Buffer.alloc(8);return e.writeBigUInt64BE(BigInt(t.length)),Buffer.concat([e,t])}var v=class r{constructor(t){this.keyPair=t;let e=Buffer.from(this.keyPair.getPublic().encode("hex",!0),"hex");this.address=mt("agent",e),this.pubKey=e.toString("hex")}static fromSeed(t,e){let s=ve(t,"agent",e),n=X.keyFromPrivate(s);return new r(n)}static generate(){let t=X.genKeyPair();return new r(t)}static fromString(t){let e=X.keyFromPrivate(t,"hex");return new r(e)}get privateKey(){return this.keyPair.getPrivate("hex")}get getAddress(){return this.address}get getPubKey(){return this.pubKey}sign(t){let e=this.keyPair.sign(t),s=this.getCanonicalSignature(e);return mt("sig",s)}signB64(t){let e=this.keyPair.sign(t);return this.getCanonicalSignature(e).toString("base64")}signDigest(t){let e=this.keyPair.sign(t),s=this.getCanonicalSignature(e);return mt("sig",s)}signRegistration(t,e,s){let n=Y.sha256.create();return n.update(Z(t)),n.update(Z(this.address)),n.update(Z(e)),n.update(Z(s)),this.signDigest(Buffer.from(n.digest()))}signArbitrary(t){let e={chain_id:"",account_number:"0",sequence:"0",fee:{gas:"0",amount:[]},msgs:[{type:"sign/MsgSignData",value:{signer:this.address,data:t.toString("base64")}}],memo:""},s=Buffer.from(JSON.stringify(e,Object.keys(e).sort(),0)),n=this.signB64(s);return[s.toString("base64"),n]}static verifyDigest(t,e,s){let[n,i]=he(t),[o,a]=he(s);if(n!=="agent")throw new Error("Unable to decode agent address");if(o!=="sig")throw new Error("Unable to decode signature");if(a.length!==64)throw new Error("Invalid signature length");let c=a.subarray(0,32),d=a.subarray(32);if(!X.keyFromPublic(i).verify(e,{r:c,s:d}))throw new Error("Unable to verify signature")}getCanonicalSignature(t){let e=t.r,s=t.s,n=X.curve.n,i=n.shrn(1),o=s;s.gt(i)&&(o=n.sub(s));let a=Buffer.from(e.toArray("be",32)),c=Buffer.from(o.toArray("be",32));return Buffer.concat([a,c])}};var Vt=class{constructor(){this._sinks=new Map}get sinks(){return this._sinks}register(t,e){var n;let s=(n=this._sinks.get(t))!=null?n:new Set;s.add(e),this._sinks.set(t,s)}unregister(t,e){let s=this._sinks.get(t);if(s){if(s.delete(e),s.size===0){this._sinks.delete(t);return}this._sinks.set(t,s)}}contains(t){return this._sinks.has(t)}dispatchMsg(t,e,s,n,i){return g(this,null,function*(){let o=this._sinks.get(e)||new Set;for(let a of o)yield a.handleMessage(t,s,n,i)})}dispatchRest(t,e,s,n){return g(this,null,function*(){let i=this._sinks.get(t)||new Set;for(let o of i)return yield o.handleRest(e,s,n)})}},k=new Vt;var Ee=require("js-sha256"),E=require("zod"),R=class r{constructor({version:t,sender:e,target:s,session:n,schemaDigest:i,protocolDigest:o,payload:a,expires:c,nonce:d,signature:p}){this.version=t,this.sender=e,this.target=s,this.session=n,this.schemaDigest=i,this.protocolDigest=o,this.payload=a,this.expires=c,this.nonce=d,this.signature=p}encodePayload(t){this.payload=Buffer.from(t).toString("base64")}decodePayload(){return this.payload?Buffer.from(this.payload,"base64").toString():""}sign(t){try{this.signature=t.signDigest(this._digest())}catch(e){throw new Error(`Failed to sign envelope: ${e}`)}}verify(){if(!this.signature)throw new Error("Envelope signature is missing");console.log("Digest",this._digest().toString("hex")),v.verifyDigest(this.sender,this._digest(),this.signature)}toJSON(){var e,s,n,i,o,a;let t={version:this.version,sender:this.sender,target:this.target,session:this.session,schema_digest:(e=this.schemaDigest)!=null?e:null,protocol_digest:(s=this.protocolDigest)!=null?s:null,payload:(n=this.payload)!=null?n:null,expires:(i=this.expires)!=null?i:null,nonce:(o=this.nonce)!=null?o:null,signature:(a=this.signature)!=null?a:null};return JSON.stringify(t)}_digest(){let t=Ee.sha256.create();if(t.update(this.sender),t.update(this.target),t.update(this.session),t.update(this.schemaDigest),this.payload&&t.update(this.payload),this.expires){let e=Buffer.alloc(8);e.writeBigUInt64BE(BigInt(this.expires)),t.update(e)}if(this.nonce!==void 0){let e=Buffer.alloc(8);e.writeBigUInt64BE(BigInt(this.nonce)),t.update(e)}return Buffer.from(t.digest())}static modelValidate(t){var n,i,o,a,c;let s=E.z.object({version:E.z.number(),sender:E.z.string(),target:E.z.string(),session:E.z.string(),schema_digest:E.z.string(),protocol_digest:E.z.string().nullish(),payload:E.z.string().nullish(),expires:E.z.number().nullish(),nonce:E.z.number().nullish(),signature:E.z.string().nullish()}).parse(t);return new r({version:s.version,sender:s.sender,target:s.target,session:s.session,schemaDigest:s.schema_digest,protocolDigest:(n=s.protocol_digest)!=null?n:void 0,payload:(i=s.payload)!=null?i:void 0,expires:(o=s.expires)!=null?o:void 0,nonce:(a=s.nonce)!=null?a:void 0,signature:(c=s.signature)!=null?c:void 0})}},Ht=class r{constructor({timestamp:t=Math.floor(Date.now()/1e3),version:e,sender:s,target:n,session:i,schemaDigest:o,protocolDigest:a,payload:c}){this.timestamp=t,this.version=e,this.sender=s,this.target=n,this.session=i,this.schemaDigest=o,this.protocolDigest=a,this.payload=c}static fromEnvelope(t){return new r({version:t.version,sender:t.sender,target:t.target,session:t.session,schemaDigest:t.schemaDigest,protocolDigest:t.protocolDigest,payload:t.decodePayload()})}},Wt=class{constructor(){this.envelopes=[]}addEntry(t){this.envelopes.push(t),this.applyRetentionPolicy()}applyRetentionPolicy(){let t=Math.floor(Date.now()/1e3)-86400;this.envelopes=this.envelopes.filter(e=>e.timestamp>=t)}};var jt=require("zod"),Ae=H(require("crypto")),ht=require("zod-openapi");(0,ht.extendZodWithOpenApi)(jt.z);var _=class r{constructor(t){if(!t||!(t instanceof jt.z.ZodType))throw new Error("Invalid input. Provide a Zod schema.");this.schema=t}validate(t){return this.schema.parse(t)}dumpJson(t){return JSON.stringify(t,null,0)}dump(t){return this.schema.parse(t)}static buildSchemaDigest(t){t instanceof r&&(t=t.schema);let e,{components:s,schema:n}=(0,ht.createSchema)(t,{componentRefPath:"#/definitions/"});console.log(n,s);let i=s?C({definitions:C({},s)},n):n,o=tt(i);return console.log(o),`model:${Ae.default.createHash("sha256").update(o,"utf8").digest("hex")}`}};function tt(r){return r===null||typeof r!="object"&&!Array.isArray(r)||Object.keys(r).length===0?JSON.stringify(r):Array.isArray(r)?"["+r.map(tt).join(", ")+"]":"{"+Object.keys(r).sort().map(s=>{var i,o;let n=r[s];if(s==="title"&&n==="Properties"||s==="type"&&r.enum&&((i=r.description)!=null&&i.includes("enumeration")))return"";if(s==="$ref")return`"${s}": "${n}"`;if(s==="type"&&n&&typeof n=="object"){if("allOf"in n){let a=(o=n.allOf)==null?void 0:o.find(c=>c.$ref);if(a)return`"${s}": ${tt({$ref:a.$ref})}`}else if("$ref"in n)return`"${s}": ${tt({$ref:n.$ref})}`}if(s==="required"&&Array.isArray(n)&&r.title==="UAgentResponse")return'"required": ["type"]';if(typeof n=="object"&&n!==null){let a=Object.keys(n);a.includes("type")&&!a.includes("title")&&s!=="Properties"&&(n.title=s.split("_").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" "))}return`"${s}": ${tt(n)}`}).filter(Boolean).join(", ")+"}"}var U=require("@cosmjs/cosmwasm-stargate");var Jt=0,Gt;function T(r,t){return t.length>Jt&&(Jt=t.length),{logLevel:r,name:t}}function l(r,t){t||(Gt||(Gt=T("INFO","default")),t=Gt);let e=`${t.logLevel}	 [${t.name.padStart(Jt)}]: ${r}`;switch(t.logLevel){case"DEBUG":console.debug(e);break;case"INFO":console.info(e);break;case"WARN":console.warn(e);break;case"ERROR":console.error(e);break}}var A=T("INFO","network"),is=1,as=30,Kt,zt,Xt=null,et=class extends Error{constructor(t="Insufficient funds for transaction"){super(t),this.name="InsufficientFundsError"}};function _t(r=!0){return g(this,null,function*(){return r?(Kt||(Kt=yield U.CosmWasmClient.connect(K)),Kt):(zt||(zt=yield U.CosmWasmClient.connect(z)),zt)})}function te(r){return g(this,null,function*(){Xt||(Xt=new Yt(qt)),yield Xt.getWealth(r)})}function os(r){return r?typeof r=="object"&&!Array.isArray(r)?Object.entries(r).map(([t,e])=>({address:t,weight:e.weight||1})):Array.isArray(r)?r.map(t=>({address:t,weight:1})):[{address:r,weight:1}]:null}function vt(n,i){return g(this,arguments,function*(r,t,e=as*1e3,s=is*1e3){let o=Date.now();for(;;){try{let a=yield t.getTx(r);if(a)return a}catch(a){}if(Date.now()-o>e)throw new Error("Transaction query timeout");yield new Promise(a=>setTimeout(a,s))}})}var Et=class{constructor(t,e){this.client=t,this.address=e}checkVersion(){return g(this,null,function*(){try{let t=yield this.getContractVersion(),[e]=t.split("."),[s]=ut.split(".");return e!==s?(l(`The deployed version of the Almanac Contract is ${t} and you are using version ${ut}. Update uAgents to the latest version to ensure compatibility.`,A),!1):!0}catch(t){return l("Failed to query contract version. Contract interactions will be disabled.",A),!1}})}queryContract(t){return g(this,null,function*(){try{let e=yield this.client.queryContractSmart(this.address,t);if(typeof e!="object")throw new Error("Invalid response format");return e}catch(e){throw l(`Query failed: ${e}`,A),e}})}getContractVersion(){return g(this,null,function*(){let t={query_contract_state:{}};return(yield this.queryContract(t)).contract_version})}getAddress(){return this.address}isRegistered(t){return g(this,null,function*(){let e={query_records:{agent_address:t}};return!!(yield this.queryContract(e)).record})}registrationNeedsUpdate(t,e,s,n){return g(this,null,function*(){let[i,o,a]=yield this.queryAgentRecord(t);return!(yield this.isRegistered(t))||i<n||JSON.stringify(e)!==JSON.stringify(o)||JSON.stringify(s)!==JSON.stringify(a)})}queryAgentRecord(t){return g(this,null,function*(){var d,p;let e={query_records:{agent_address:t}},s=yield this.queryContract(e);if(!s.record){let u=yield this.queryContract({query_contract_state:{}});return[(((d=u==null?void 0:u.state)==null?void 0:d.expiry_height)||0)*dt,[],[]]}let n=((p=s.record[0])==null?void 0:p.expiry)||0,i=s.height||0,o=(n-i)*dt,a=s.record[0].record.service.endpoints.map(u=>({url:u.url,weight:u.weight})),c=s.record[0].record.service.protocols;return[o,a,c]})}getExpiry(t){return g(this,null,function*(){let[e]=yield this.queryAgentRecord(t);return e})}getEndpoints(t){return g(this,null,function*(){let[,e]=yield this.queryAgentRecord(t);return e})}getProtocols(t){return g(this,null,function*(){let[,,e]=yield this.queryAgentRecord(t);return e})}getRegistrationMsg(t,e,s,n,i){return{register:{record:{service:{protocols:t,endpoints:e.map(o=>({url:o.url,weight:o.weight}))}},signature:s,sequence:n,agent_address:i}}}register(t,e,s,n,i,o,a){return g(this,null,function*(){if(!this.address)throw new Error("Contract address not set");let[c]=yield e.getAccounts();if(!c)throw new Error("No account found in wallet");let d=this.getRegistrationMsg(n,i,o,a,s),p=[{denom:lt,amount:L}],u=yield t.execute(c.address,this.address,d,"auto","",p);yield vt(u.transactionHash,this.client)})}registerBatch(t,e,s){return g(this,null,function*(){if(!this.address)throw new Error("Contract address not set");let[n]=yield e.getAccounts();if(!n)throw new Error("No account found in wallet");let i=s.map(a=>{if(a.timestamp===void 0)throw new Error("Agent record is missing timestamp");if(a.signature===void 0)throw new Error("Agent record is not signed");return{typeUrl:"/cosmwasm.wasm.v1.MsgExecuteContract",value:{sender:n.address,contract:this.address,msg:this.getRegistrationMsg(a.protocols,a.endpoints,a.signature,a.timestamp,a.agent_address),funds:[{denom:lt,amount:L}]}}}),o=yield t.signAndBroadcast(n.address,i,"auto");yield vt(o.transactionHash,this.client)})}getSequence(t){return g(this,null,function*(){let e={query_sequence:{agent_address:t}};return(yield this.queryContract(e)).sequence})}},ft=null,yt=null;function ee(r=!0){return g(this,null,function*(){if(r){if(!yt){let t=yield _t(!0);yt=new Et(t,$t)}return(yield yt.checkVersion())?yt:null}if(!ft){let t=yield _t(!1);ft=new Et(t,Bt)}return(yield ft.checkVersion())?ft:null})}var At=class{constructor(t,e){this.client=t,this.address=e}queryContract(t){return g(this,null,function*(){try{let e=yield this.client.queryContractSmart(this.address,t);if(typeof e!="object")throw new Error("Invalid response format");return e}catch(e){throw l(`Query failed: ${e}`,A),e}})}isNameAvailable(t,e){return g(this,null,function*(){let s={domain_record:{domain:`${t}.${e}`}};return(yield this.queryContract(s)).is_available})}isOwner(t,e,s){return g(this,null,function*(){let n={permissions:{domain:`${t}.${e}`,owner:s}};return(yield this.queryContract(n)).permissions==="admin"})}isDomainPublic(t){return g(this,null,function*(){var s;let e=(s=yield this.queryContract({query_domain_flags:{domain:t.split(".").pop()}}))==null?void 0:s.domain_flags;return e?e.web3_flags.is_public:!1})}getPreviousRecords(t,e){return g(this,null,function*(){let s={domain_record:{domain:`${t}.${e}`}},n=yield this.queryContract(s);return n.record!==null?n.record.records[0].agent_address.records:[]})}getRegistrationTx(t,e,s,n,i){return g(this,null,function*(){let o=i?gt:ct,a={messages:[]};if(yield this.isNameAvailable(t,n)){let c=(yield this.queryContract({contract_state:{}})).price_per_second,d=BigInt(c.amount)*BigInt(86400),p=c.denom;a.messages.push({typeUrl:"/cosmwasm.wasm.v1.MsgExecuteContract",value:{sender:e,contract:o,msg:{register:{domain:`${t}.${n}`}},funds:[{amount:d.toString(),denom:p}]}})}else if(!(yield this.isOwner(t,n,e)))return null;return a.messages.push({typeUrl:"/cosmwasm.wasm.v1.MsgExecuteContract",value:{sender:e,contract:o,msg:{update_record:{domain:`${t}.${n}`,agent_records:s}}}}),a})}register(t,e,s,n,i,o=!0){return g(this,null,function*(){l("Registering name...",A);let a=os(s);if(!a)throw new Error("Invalid record configuration");let[c]=yield e.getAccounts();if(!c)throw new Error("No account found in wallet");let d=(yield t.getChainId())==="dorado-1",p=yield ee(d);for(let M of a)if(!p||!(yield p.isRegistered(M.address))){l(`Address ${M.address} needs to be registered in almanac contract to be registered in a domain.`,A);return}if(!(yield this.isDomainPublic(i))){l(`Domain ${i} is not public, please select a public domain`,A);return}let u=a;if(!o){let M=yield this.getPreviousRecords(n,i),P=new Map;[...M,...a].forEach(b=>{P.set(`${b.address}_${b.weight}`,b)}),u=Array.from(P.values())}let m=yield this.getRegistrationTx(n,c.address,u,i,d);if(!m){l(`Please select another name, ${n} is owned by another address`,A);return}let w=yield(yield U.SigningCosmWasmClient.connectWithSigner(d?K:z,e)).signAndBroadcast(c.address,m.messages,"auto");yield vt(w.transactionHash,this.client),l("Registering name...complete",A)})}unregister(t,e,s,n=!0){return g(this,null,function*(){if(l("Unregistering name...",A),yield this.isNameAvailable(t,e)){l("Nothing to unregister... (name is not registered)",A);return}let i=yield U.SigningCosmWasmClient.connectWithSigner(n?K:z,s),[o]=yield s.getAccounts();if(!o)throw new Error("No account found in wallet");let a={remove_domain:{domain:`${t}.${e}`}},c=yield i.execute(o.address,this.address,a,"auto");yield vt(c.transactionHash,this.client),l("Unregistering name...complete",A)})}},Zt=null,Qt=null;function we(r=!0){return g(this,null,function*(){if(r){if(!Qt){let t=yield _t(!0);Qt=new At(t,gt)}return Qt}if(!Zt){let t=yield _t(!1);Zt=new At(t,ct)}return Zt})}var N=class N{constructor(t){this.faucetUrl=t}getWealth(t){return g(this,null,function*(){let e=yield this.createFaucetClaim(t);if(!e)throw new Error("Unable to create faucet claim");let s=N.MAX_RETRY_ATTEMPTS;for(;s>0;){let n=yield this.checkFaucetClaim(e);if(!n)throw new Error("Failed to check faucet claim status");if(n.status==="complete")break;if(n.status==="failed")throw new Error(`Failed to get wealth for ${t}`);yield new Promise(i=>setTimeout(i,N.POLL_INTERVAL_MS)),s--}if(s===0)throw new Error("Faucet claim check timed out");yield new Promise(n=>setTimeout(n,N.FINAL_WAIT_INTERVAL_MS))})}createFaucetClaim(t){return g(this,null,function*(){try{let e=yield fetch(`${this.faucetUrl}/api/v3/claims`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:t})});return e.ok?(yield e.json()).uuid:null}catch(e){return null}})}checkFaucetClaim(t){return g(this,null,function*(){var e;try{let s=yield fetch(`${this.faucetUrl}/api/v3/claims/${t}`);if(!s.ok)return null;let n=yield s.json();return{txDigest:((e=n.claim.txStatus)==null?void 0:e.hash)||null,status:n.claim.status}}catch(s){return null}})}};N.MAX_RETRY_ATTEMPTS=30,N.POLL_INTERVAL_MS=2e3,N.FINAL_WAIT_INTERVAL_MS=5e3;var Yt=N;var be=T("WARN","resolver");function re(r,t=void 0,e=1){return t?t.map(i=>Math.pow(Math.random(),1/i)).map((i,o)=>({value:i,index:o})).sort((i,o)=>o.value-i.value).slice(0,e).map(i=>i.index).map(i=>r[i]):[...r].sort(()=>Math.random()-.5).slice(0,e)}function cs(r){return F(r)||r.length===kt&&r.startsWith(Lt)}function gs(r){return[Ot,j,""].includes(r)}function B(r){let t="",e="",s="";return r.includes("://")&&([t,r]=r.split("://",2)),r.includes("/")&&([e,r]=r.split("/",2)),cs(r)?s=r:e=r,[t,e,s]}function ls(r,t,e){return g(this,null,function*(){let s=yield ee(e);if(!s)throw l(`Failed to get Almanac contract for ${e?"testnet":"mainnet"}`),new Error(`Failed to get Almanac contract for ${e?"testnet":"mainnet"}`);let n={query_record:{agent_address:r,record_type:t}};return yield s.queryContract(n)})}function ds(r,t){return g(this,null,function*(){var i,o;let e={domain_record:{domain:r}},n=yield(yield we(t)).queryContract(e);if(!n)throw l(`Failed to get NameService contract for ${t?"testnet":"mainnet"}`),new Error(`Failed to get NameService contract for ${t?"testnet":"mainnet"}`);if(n.record!==null){let a=((o=(i=n.record.records[0])==null?void 0:i.agent_address)==null?void 0:o.records)||[];if(a.length>0){let c=a.map(u=>u.address),d=a.map(u=>u.weight),p=re(c,d);return p.length>0?p[0]:null}}return null})}var D=class{},bt=class extends D{constructor(t){super(),this._maxEndpoints=t||O}resolve(t){return g(this,null,function*(){var o;let[e,,s]=B(t),i=yield ls(s,"service",e!==j);if(i){let c=((o=(i.record||{}).service)==null?void 0:o.endpoints)||[];if(c.length>0){let d=c.map(u=>u.url),p=c.map(u=>u.weight);return[s,re(d,p,Math.min(this._maxEndpoints,d.length))]}}return[null,[]]})}},st=class extends D{constructor(t,e){super(),this._maxEndpoints=t||O,this._almanacApiUrl=e||I,this._almanacContractResolver=new bt(this._maxEndpoints)}_apiResolve(t){return g(this,null,function*(){try{let[,,e]=B(t),s=yield fetch(`${this._almanacApiUrl}/agents/${e}`);if(s.status!==200)return s.status!==404&&l(`Failed to resolve agent ${e} from ${this._almanacApiUrl}, resolving via Almanac contract...`,be),[null,[]];let n=yield s.json(),i=n.expiry;if(!i)return[null,[]];let o=new Date(i),a=new Date,c=n.endpoints||[];if(c.length>0&&o>a){let d=c.map(u=>u.url),p=c.map(u=>u.weight);return[e,re(d,p,Math.min(this._maxEndpoints,d.length))]}}catch(e){l(`Error in AlmanacApiResolver when resolving ${t}: ${e}`,be)}return[null,[]]})}resolve(t){return g(this,null,function*(){let[e,s]=yield this._apiResolve(t);return e!==null?[e,s]:yield this._almanacContractResolver.resolve(t)})}},St=class extends D{constructor(t){super(),this._maxEndpoints=t||O,this._almanacApiResolver=new st(this._maxEndpoints)}resolve(t){return g(this,null,function*(){let[e,s]=B(t),i=yield ds(s,e!==j);return i!==null?yield this._almanacApiResolver.resolve(i):[null,[]]})}},rt=class extends D{constructor(t,e){super(),this._maxEndpoints=t||O,this._almanacApiResolver=new st(this._maxEndpoints,e),this._nameServiceResolver=new St(this._maxEndpoints)}resolve(t){return g(this,null,function*(){let[e,,s]=B(t);return gs(e)?yield(s?this._almanacApiResolver:this._nameServiceResolver).resolve(t):[null,[]]})}},se=class extends D{constructor(t,e){super(),this._rules=t,this._maxEndpoints=e||O}resolve(t){return g(this,null,function*(){let e=this._rules[t];return typeof e=="string"?e=[e]:e||(e=[]),e.length>this._maxEndpoints&&(e=e.slice(0,this._maxEndpoints)),[t,e]})}};var ps=T("DEBUG","dispenser");function ms(r,t,e=!1){return g(this,null,function*(){let s={"content-type":"application/json"};e&&(s["x-uagents-connection"]="sync");let n=[];for(let i of t)try{let o=yield fetch(i,{method:"POST",headers:s,body:JSON.stringify(r)});if(o.ok){if(e){let a=R.modelValidate(yield o.json());if(a.signature){let c=!1;try{a.verify(),c=!0}catch(d){n.push(`Received response envelope that failed verification: ${d}`)}if(!c)continue}return yield hs(a)}return{status:"delivered",detail:"Message successfully delivered via HTTP",destination:r.target,endpoint:i,session:r.session}}n.push(yield o.text())}catch(o){n.push(`Failed to send message: ${o}`)}return l(`Failed to deliver message to ${r.target} @ ${t}: ${n.join(", ")}`,ps),{status:"failed",detail:"Message delivery failed",destination:r.target,endpoint:"",session:r.session}})}function hs(r){return g(this,null,function*(){return k.sinks.size===0?r:(yield k.dispatchMsg(r.sender,r.target,r.schemaDigest,r.decodePayload(),r.session),{status:"delivered",detail:"Sync message successfully delivered via HTTP",destination:r.target,endpoint:"",session:r.session})})}function fs(c,d,p,u,m,q){return g(this,arguments,function*(r,t,e,s,n,i,o=x,a=!1){let w;if(typeof n=="string"&&F(n)&&(w=n),n||(n=v.generate()),n instanceof v&&(w=n.getAddress),!w)throw new Error("Invalid sender address");i||(i=new rt);let[M,P]=yield i.resolve(r);if(!P||!M)return{status:"failed",detail:"Failed to resolve destination address",destination:r,endpoint:"",session:void 0};let b=new R({version:1,sender:w,target:M,session:(0,Se.v4)(),schemaDigest:t,expires:Math.floor(Date.now()/1e3)+o});b.encodePayload(e),!F(w)&&n instanceof v&&b.sign(n);let S=yield ms(b,P,a);if(S instanceof R){if(!b.signature)return S;let at=S.decodePayload();return s?s.modelValidateJson(at):at}return S})}function xe(a,c,d,p,u){return g(this,arguments,function*(r,t,e,s,n,i=x,o=!1){return yield fs(r,_.buildSchemaDigest(t),t.dumpJson(t),e,s,n,i,o)})}function ys(o,a,c,d,p){return g(this,arguments,function*(r,t,e,s,n,i=x){return yield xe(r,t,e,s,n,i,!0)})}function _s(r,t,e,s=""){return Re(r.dumpJson(r),_.buildSchemaDigest(r),t,e,s)}function Re(r,t,e,s,n=""){let i=new R({version:1,sender:e,target:n,session:s,schemaDigest:t});return i.encodePayload(r),JSON.stringify(i,null,0)}var Me=require("uuid");var xt=require("zod");var Pe=xt.z.object({error:xt.z.string(),details:xt.z.string().optional()}).openapi({title:"ErrorMessage"}),vs=_.buildSchemaDigest(Pe);function Es(r){let t="",e="",s="";return r.includes("://")&&([t,r]=r.split("://",2)),r.includes("/")&&([e,r]=r.split("/",2)),As(r)?s=r:e=r,[t,e,s]}function As(r){return!0}var Rt=class{},Mt=class extends Rt{constructor(e,s,n,i,o,a,c,d,p){super();this._outboundMessages=new Map;this._agent=e,this._storage=s,this._ledger=n,this._resolver=i,this._dispenser=o,this._logger=p,this._session=a||(0,Me.v4)(),this._intervalMessages=c,this._walletMessagingClient=d}get agent(){return this._agent}get storage(){return this._storage}get ledger(){return this._ledger}get logger(){return this._logger||(this._logger={logLevel:"INFO",name:"internal"}),this._logger}get session(){return this._session}get outboundMessages(){return this._outboundMessages}get address(){return this.agent.address}getAgentsByProtocol(i){return g(this,arguments,function*(e,s=pt,n){var a;if(!e.startsWith("proto:"))return l(`Invalid protocol digest: ${e}`,n),[];let o=((a=this._resolver._almanacApiResolver)==null?void 0:a._almanacApiUrl)||I;try{let c=yield fetch(`${o}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e.slice(6)}),signal:AbortSignal.timeout(x*1e3)});if(c.ok)return(yield c.json()).filter(u=>u.status==="active").map(u=>u.address).slice(0,s)}catch(c){l(`Failed to query Almanac API: ${c}`,n)}return[]})}broadcast(o,a){return g(this,arguments,function*(e,s,n=pt,i=x){let c=yield this.getAgentsByProtocol(e,n,this.logger);if(!c.length)return l(`No active agents found for: ${e}`,this.logger),[];let p=c.filter(m=>m!==this.agent.address).map(m=>this.send(m,s,!1,i)),u=yield Promise.all(p);return l(`Sent ${u.length} messages`,this.logger),u})}_isValidIntervalMessage(e){return this._intervalMessages?this._intervalMessages.has(e):!0}send(o,a){return g(this,arguments,function*(e,s,n=!1,i=x){let c=_.buildSchemaDigest(s),d=JSON.stringify(s.dump({}));return this._isValidIntervalMessage(c)?this.sendRaw(e,c,d,n,i):(l(`Invalid interval message: ${s}`,this.logger),{status:"failed",detail:"Invalid interval message",destination:e,endpoint:"",session:this._session})})}sendRaw(d,p,u){return g(this,arguments,function*(e,s,n,i=!1,o=x,a,c){let[,,m]=Es(e);if(m){if(k.contains(m))return yield k.dispatchMsg(this.agent.address,m,s,n,this._session),{status:"delivered",detail:"Message dispatched locally",destination:m,endpoint:"",session:this._session};if(c!=null&&c.has(m)){let S=c.get(m);return c.delete(m),yield S,{status:"delivered",detail:"Sync message resolved",destination:m,endpoint:"",session:this._session}}this._outboundMessages.set(m,[n,s])}let[q,w]=yield this._resolver.resolve(e);if(!w.length||!q)return l("Unable to resolve destination endpoint",this.logger),{status:"failed",detail:"Unable to resolve destination endpoint",destination:e,endpoint:"",session:this._session};let M=Math.floor(Date.now()/1e3)+o,P=new R({version:1,sender:this.agent.address,target:q,session:this._session,schemaDigest:s,protocolDigest:a,expires:M});P.encodePayload(n),P.sign({signDigest:this.agent.signDigest});let b=new Promise((S,at)=>{setTimeout(()=>at(new Error("Timeout")),o*1e3)});this._queueEnvelope(P,w,b,i);try{let S=yield b;return S instanceof R?{status:"delivered",detail:"Sync response received",destination:e,endpoint:w[0]||"",session:this._session}:S}catch(S){return l("Timeout waiting for dispense response",this.logger),{status:"failed",detail:"Timeout waiting for response",destination:e,endpoint:"",session:this._session}}})}_queueEnvelope(e,s,n,i=!1){this._dispenser.addEnvelope(e,s,n,i)}sendWalletMessage(e,s,n=1){return g(this,null,function*(){this._walletMessagingClient?yield this._walletMessagingClient.send(e,s,n):l("Cannot send wallet message: no client available",this.logger)})}},ne=class extends Mt{constructor(t,e,s,n,i,o,a,c,d,p,u,m,q){super(e,s,n,i,o,p,u,m,q),this._queries=a||new Map,this._replies=c,this._messageReceived=t,this._protocol=d||["",null]}_isValidReply(t){if(t===vs)return!0;if(!this._messageReceived)throw new Error("No message received");if(!this._replies)return!0;let e=this._messageReceived,s=this._replies.get(e.schema_digest);return s?s.has(t):!1}send(i,o){return g(this,arguments,function*(t,e,s=!1,n=x){let a=_.buildSchemaDigest(e);return this._isValidReply(a)?this.sendRaw(t,a,JSON.stringify(e.dump({})),s,n,this._protocol[0],this._queries):(l(`Outgoing message '${e.constructor.name}' is not a valid reply to received message: ${this._messageReceived.schema_digest}`,this.logger),{status:"failed",detail:"Invalid reply",destination:t,endpoint:"",session:this._session})})}};var ws="tmp";var Ce=require("zod"),Te=H(require("crypto")),Ie=require("zod-openapi");(0,Ie.extendZodWithOpenApi)(Ce.z);var bs="3.0.2",ie=class r{constructor(t,e){this._intervalHandlers=[];this._intervalMessages=new Set;this._signedMessageHandlers={};this._unsignedMessageHandlers={};this._models={};this._replies={};this._name=t||"",this._version=e||"0.1.0",this._canonicalName=`${this._name}:${this._version}`,this._digest="",this.spec={title:this._name,version:this._version,openapi_version:bs}}get intervals(){return this._intervalHandlers}get models(){return this._models}get replies(){return this._replies}get intervalMessages(){return this._intervalMessages}get signedMessageHandlers(){return this._signedMessageHandlers}get unsignedMessageHandlers(){return this._unsignedMessageHandlers}get name(){return this._name}get version(){return this._version}get canonicalName(){return this._canonicalName}get digest(){return this.manifest().metadata.digest}onInterval(t,e){return s=>(this._addIntervalHandler(t,s,e),s)}_addIntervalHandler(t,e,s){this._intervalHandlers.push([e,t]),s&&(s instanceof Set?s:new Set([s])).forEach(i=>{let o=_.buildSchemaDigest(i);this._intervalMessages.add(o)})}onQuery(t,e){return this.onMessage(t,e,!0)}onMessage(t,e,s=!1){return n=>(this._addMessageHandler(t,n,e,s),n)}_addMessageHandler(t,e,s,n=!1){let i=_.buildSchemaDigest(t);if(this._models[i]=t,n?this._unsignedMessageHandlers[i]=e:this._signedMessageHandlers[i]=e,s){let o=s instanceof Set?s:new Set([s]);this._replies[i]={},o.forEach(a=>{let c=_.buildSchemaDigest(a);this._models[c]=a})}}manifest(){let t={name:this._name,version:this._version},e={version:"1.0",metadata:{},models:[],interactions:[]},s={};Object.entries(this._models).forEach(([a,c])=>{s[a]||(s[a]=c)}),Object.values(this._replies).forEach(a=>{Object.entries(a).forEach(([c,d])=>{s[c]||(s[c]=d)})}),Object.entries(s).forEach(([a,c])=>{e.models.push({digest:a,schema:c.dump({})})}),Object.entries(this._replies).forEach(([a,c])=>{e.interactions.push({type:this._unsignedMessageHandlers[a]?"query":"normal",request:a,responses:Object.keys(c)})});let n=$(C({},e),{metadata:{}}),i=JSON.stringify(n,null,0);return t.digest=r.computeDigest(e),$(C({},e),{metadata:t})}static computeDigest(t){let e=$(C({},t),{metadata:{}}),s=JSON.stringify(e,null,0);return`proto:${Te.default.createHash("sha256").update(s).digest("hex")}`}};var Ss="tmp";var Ne=H(require("crypto"));var y=T("INFO","AgentRegistration");function xs(r){return Math.min(me(2,r+6),131072)/1e3}function Rs(r){let t=new Set;return JSON.stringify(r,(e,s)=>(t.add(e),s)),JSON.stringify(r,Array.from(t).sort())}var ae=class{constructor(t){this.agent_identifier=t}sign(t){this.timestamp=Math.floor(Date.now()/1e3);let e=this._buildDigest();this.signature=t.signDigest(e)}verify(){if(!this.signature)throw new Error("signature is missing");v.verifyDigest(this.agent_identifier,this._buildDigest(),this.signature)}_buildDigest(){let t=Rs($(C({},this),{signature:void 0})),e=Ne.createHash("sha256");return e.update(t,"utf-8"),e.digest()}},Pt=class extends ae{constructor(t,e,s,n=null){super(t),this.protocols=e,this.endpoints=s,this.metadata=n}},oe=class{constructor(t){this.attestations=t}};function De(s,n){return g(this,arguments,function*(r,t,e=G){for(let i=0;i<e;i++)try{let o=yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(o.ok)return!0;l(`API responded with ${o.status}: ${yield o.text()}`,y)}catch(o){if(i===e-1)return l(`Failed after ${e} retries: ${o}`,y),!1;yield new Promise(a=>setTimeout(a,xs(i)))}return!1})}var nt=class{},it=class{},Ct=class extends nt{constructor(t,e=I){super(),this.identity=t,this.almanacApi=e,this.maxRetries=G}register(t,e,s,n=null){return g(this,null,function*(){let i=new Pt(t,e,s,n);if(i.sign(this.identity),yield De(`${this.almanacApi}/agents`,i,this.maxRetries))l("Registration on Almanac API successful",y);else throw new Error("Registration on Almanac API failed")})}},Tt=class extends nt{constructor(t,e,s,n,i){super(),this.identity=t,this.ledger=e,this.wallet=s,this.almanacContract=n,this.testnet=i}register(t,e,s,n=null){return g(this,null,function*(){let i=B(t)[2],o=yield this.almanacContract.isRegistered(i),a=yield this.almanacContract.getExpiry(i),c=yield this.almanacContract.getEndpoints(i),d=yield this.almanacContract.getProtocols(i);if(!o||a<Ft||JSON.stringify(s)!==JSON.stringify(c)||JSON.stringify(e)!==JSON.stringify(d)){if((yield this.ledger.queryBankBalance(this.wallet.address()))<parseInt(L))if(this.testnet)yield te(this.wallet.address());else throw new et("Not enough funds for registration.");l("Registering on Almanac contract...",y);let u=Math.floor(Date.now()/1e3)-J,m=this.identity.signRegistration(this.almanacContract.getAddress(),u,this.wallet.address());yield this.almanacContract.register(this.ledger,this.wallet,i,e,s,m,u),l("Registration on Almanac contract complete",y)}else l("Almanac contract registration is up to date",y)})}},It=class extends it{constructor(t=I){super(),this.almanacApi=t,this.attestations=[],this.maxRetries=G}addAgent(t,e){let s=new Pt(`${t.prefix}://${t.agent_address}`,t.protocols,t.endpoints,t.metadata);s.sign(e),this.attestations.push(s)}register(){return g(this,null,function*(){if(this.attestations.length===0){l("No agents to register in batch.",y);return}let t=new oe(this.attestations);if(yield De(`${this.almanacApi}/agents/batch`,t,this.maxRetries))l("Batch registration on Almanac API successful",y);else throw new Error("Batch registration on Almanac API failed")})}},Nt=class extends it{constructor(t,e,s,n){super(),this.ledger=t,this.wallet=e,this.almanacContract=s,this.testnet=n,this.records=[],this.identities={}}addAgent(t,e){let s={agentAddress:t.agent_address,protocols:t.protocols,endpoints:t.endpoints,contractAddress:this.almanacContract.getAddress(),senderAddress:this.wallet.address()};this.records.push(s),this.identities[t.agent_address]=e}getBalance(){return g(this,null,function*(){return yield this.ledger.queryBankBalance(this.wallet.address())})}register(){return g(this,null,function*(){if(this.records.length===0){l("No agents to register in batch.",y);return}if((yield this.getBalance())<parseInt(L)*this.records.length)if(l(`Insufficient funds to register ${this.records.length} agents.`,y),this.testnet)yield te(this.wallet.address()),l("Testnet funds added.",y);else throw new et("Not enough funds for batch registration.");for(let e of this.records){let s=this.identities[e.agentAddress];if(!s)throw new Error(`Identity for agentAddress ${e.agentAddress} is not defined.`);let n=Math.floor(Date.now()/1e3)-J;e.signature=s.signRegistration(e.contractAddress,n,e.senderAddress)}yield this.almanacContract.registerBatch(this.ledger,this.wallet,this.records),l("Batch registration on Almanac contract complete.",y)})}},ce=class extends nt{constructor(t,e,s,n,i=!0){super(),this.apiPolicy=new Ct(t),e&&s&&n&&(this.ledgerPolicy=new Tt(t,e,s,n,i))}register(t,e,s,n=null){return g(this,null,function*(){try{yield this.apiPolicy.register(t,e,s,n)}catch(i){l(`API registration failed: ${i}`,y)}if(this.ledgerPolicy)try{yield this.ledgerPolicy.register(t,e,s,n)}catch(i){l(`Ledger registration failed: ${i}`,y)}})}},ge=class extends it{constructor(t,e,s,n=!0){super(),this.apiPolicy=new It,t&&e&&s&&(this.ledgerPolicy=new Nt(t,e,s,n))}addAgent(t,e){this.apiPolicy.addAgent(t,e),this.ledgerPolicy&&this.ledgerPolicy.addAgent(t,e)}register(){return g(this,null,function*(){try{yield this.apiPolicy.register()}catch(t){l(`API batch registration failed: ${t}`,y)}if(this.ledgerPolicy)try{yield this.ledgerPolicy.register()}catch(t){l(`Ledger batch registration failed: ${t}`,y)}})}};var Dt=H(require("fs")),Le=H(require("path"));var Oe=require("elliptic"),Vr=new Oe.ec("secp256k1"),le=class{constructor(t,e=null){this._data={};this._name=t||"my";let s=e||process.cwd();this._path=Le.default.join(s,`${this._name}_data.json`),Dt.default.existsSync(this._path)&&this._load()}get(t){return this._data[t]||null}has(t){return t in this._data}set(t,e){this._data[t]=e,this._save()}remove(t){t in this._data&&(delete this._data[t],this._save())}clear(){this._data={},this._save()}_load(){let t=Dt.default.readFileSync(this._path,"utf-8");this._data=JSON.parse(t)}_save(){Dt.default.writeFileSync(this._path,JSON.stringify(this._data,null,4),"utf-8")}};var Ms="tmp";0&&(module.exports={AGENTVERSE_URL,AGENT_ADDRESS_LENGTH,AGENT_PREFIX,ALMANAC_API_MAX_RETRIES,ALMANAC_API_TIMEOUT_SECONDS,ALMANAC_API_URL,ALMANAC_CONTRACT_VERSION,ALMANAC_REGISTRATION_WAIT,ASGI,AVERAGE_BLOCK_INTERVAL,Agent,AlmanacApiRegistrationPolicy,AlmanacApiResolver,AlmanacContractResolver,BatchAlmanacApiRegistrationPolicy,BatchLedgerRegistrationPolicy,Context,DEFAULT_ENVELOPE_TIMEOUT_SECONDS,DEFAULT_MAX_ENDPOINTS,DEFAULT_SEARCH_LIMIT,DefaultBatchRegistrationPolicy,DefaultRegistrationPolicy,Envelope,EnvelopeHistory,EnvelopeHistoryEntry,ErrorMessage,ExternalContext,GlobalResolver,Identity,InternalContext,KeyValueStore,LEDGER_PREFIX,LedgerBasedRegistrationPolicy,MAILBOX_POLL_INTERVAL_SECONDS,MAINNET_CONTRACT_ALMANAC,MAINNET_CONTRACT_NAME_SERVICE,MAINNET_PREFIX,MAINNET_RPC,Model,NameServiceResolver,Protocol,REGISTRATION_DENOM,REGISTRATION_FEE,REGISTRATION_RETRY_INTERVAL_SECONDS,REGISTRATION_UPDATE_INTERVAL_SECONDS,RESPONSE_TIME_HINT_SECONDS,Resolver,RulesBasedResolver,TESTNET_CONTRACT_ALMANAC,TESTNET_CONTRACT_NAME_SERVICE,TESTNET_FAUCET,TESTNET_PREFIX,TESTNET_RPC,USER_PREFIX,WALLET_MESSAGING_POLL_INTERVAL_SECONDS,Wallet,deriveKeyFromSeed,dispatcher,encloseResponse,encloseResponseRaw,encodeLengthPrefixed,generateUserAddress,isUserAddress,mailbox,parseAgentverseConfig,parseEndpointConfig,parseIdentifier,query,sendMessage,sendSyncMessage,...require("util")});
